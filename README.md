# tsdoc2docusaurus-ts

A CLI application to convert TSDoc files generated by
[api-extractor](https://api-extractor.com)/[api-documenter](https://api-extractor.com/pages/overview/demo_docs/)
into Docusaurus documentation.

The converter parses the files in the `api-extractor` folder and produces `.md` files in the `/docs/api/` directory. For precise control over presentation, the generated content is Markdown & HTML. As Docusaurus only parses Markdown section headers to automatically generate the Table of Contents, the converter outputs these headers in Markdown.

Work in progress.

## Prerequisites

```ts
npm install @microsoft/api-extractor --save-dev
npm --prefix website @microsoft/api-documenter --save-dev
```

In project `package.json`

```ts
    "api-extractor": "api-extractor run --local --verbose",
```

In website `pacakge.json`

```ts
    "api-documenter": "del-cli --force ../api-extractor/markdown && api-documenter markdown --input-folder ../api-extractor --output-folder ../api-extractor/markdown",
    "convert-tsdoc-webpreview": "tsdoc2docusaurus --id webpreview",
    "generate-api": "npm run api-documenter && npm run convert-tsdoc-webpreview",
    "convert-tsdoc-website": "tsdoc2docusaurus --id website",
```


### The api-extractor configuration

Add the `config/api-extractor.json` file.

```json
{
  "mainEntryPointFilePath": "<projectFolder>/dist/index.d.ts",
  "compiler": {
    "tsconfigFilePath": "<projectFolder>/src/tsconfig.json",
  },
  "apiReport": {
    "enabled": true,
    "reportTempFolder": "<projectFolder>/api-extractor/",
    "includeForgottenExports": true
  },
  "docModel": {
    "enabled": true,
    "apiJsonFilePath": "<projectFolder>/api-extractor/<unscopedPackageName>.api.json",
    "includeForgottenExports": true,
    "projectFolderUrl": "https://github.com/xpack/xpm-lib-ts.git/tree/development"
  }
}
```

`api-extractor` starts the project parsing from the compiled `index.d.ts`,
and requires the original comments not be removed. For this be sure
the `compilerOptions.removeComments` is **not** defined in the top
`tsconfig.json`, for example:

```json
{
  "extends": "@tsconfig/node20/tsconfig.json",
  "compilerOptions": {
    /* Visit https://aka.ms/tsconfig to read more about this file */
    /* https://www.npmjs.com/package/@tsconfig/node20 */

    "declaration": true,
    "declarationMap": true,
    "sourceMap": true,
    // "removeComments": true,

    "forceConsistentCasingInFileNames": true,
  }
}
```


## Installing the Converter

- https://api-extractor.com/pages/overview/demo_docs/

To install the converter in your projectâ€™s website directory, run:

```sh
npm --prefix website install @xpack/tsdoc2docusaurus --save-dev
```

Alternatively, during development:

```sh
npm --prefix website link @xpack/tsdoc2docusaurus)
```

## Converter Configuration

By default, the converter attempts to retrieve its configuration from the
following places:

- the `config/tsdoc2docusaurus.json` file
- the `tsdoc2docusaurus.json` file
- the `config.tsdoc2docusaurus` object in `package.json`
- the `tsdoc2docusaurus` object in `package.json`

For example:

```json
{
  "apiJsonInputFolderPath": "../api-extractor",
  "apiMarkdownInputFolderPath": "../api-extractor/markdown",
  "baseUrl": "/my-project-ts/",
  "verbose": true,
  "debug": false
}
```

If your `api-extractor` files are located elsewhere, update the `apiJsonInputFolderPath` and `apiMarkdownInputFolderPath` properties accordingly.

The converter will process all `.api.json` files available within the input folder.

To simplify running the conversion, add a npm script to your `website/package.json`:

```json
  "scripts": {
    "docusaurus": "docusaurus",
    "convert-tsdoc": "tsdoc2docusaurus",
    "start": "docusaurus start",
    "build": "docusaurus build",
    ...
  }
```

To execute the conversion, use:

```sh
npm run convert-tsdoc
```

If a web preview is the `website/config/tsdoc2docusaurus.json` can be:

```json
{
  "webpreview": {
    "apiJsonInputFolderPath": "../api-extractor",
    "apiMarkdownInputFolderPath": "../api-extractor/markdown",
    "apiFolderPath": "api",
    "baseUrl": "/doxygen2docusaurus-cli-ts/",
    "apiBaseUrl": "api",
    "navbarFilePath": "docusaurus-config-navbar-tsdoc.json",
    "sidebarCategoryFilePath": "sidebar-category-tsdoc.json",
    "customCssFilePath": "src/css/custom-tsdoc2docusaurus.css",
    "navbarLabel": "API Reference",
    "navbarPosition": "left",
    "verbose": false,
    "debug": false
  },
  "website": {
    "apiJsonInputFolderPath": "../api-extractor",
    "apiMarkdownInputFolderPath": "../api-extractor/markdown",
    "apiFolderPath": "api",
    "baseUrl": "/doxygen2docusaurus/",
    "apiBaseUrl": "api",
    "navbarFilePath": "docusaurus-config-navbar-tsdoc.json",
    "sidebarCategoryFilePath": "sidebar-category-tsdoc.json",
    "customCssFilePath": "src/css/custom-tsdoc2docusaurus.css",
    "navbarLabel": "API Reference",
    "navbarPosition": "left",
    "verbose": false,
    "debug": false
  }
}
```

## Common Markdown

As MDX syntax is particularly strict and does not support all HTML content, the output is Common Markdown.

To configure Docusaurus to parse `.md` files as Common Markdown, add the following to your `docusaurus-config.ts` file:

```ts
  markdown: {
    format: 'detect'
  },
```

## CSS

The converter generates a file containing custom CSS definitions.

To include this in Docusaurus, edit your `docusaurus-config.ts` file and add the following line to the theme configuration:

```ts
  theme: {
    customCss: [
      './src/css/custom.css',
      './src/css/custom-tsdoc2docusaurus.css'
    ],
  },
```

## Sidebar

The converter generates a dedicated sidebar for the TSDoc pages.

To integrate this into Docusaurus, edit your `sidebars.ts` file and add the following import at the top:

```ts
import tsdocSidebarItems from './sidebar-category-tsdoc2docusaurus.json';
```

Subsequently, add a new property to the `sidebars` object:

```ts
const sidebars: SidebarsConfig = {

  docsSidebar: [
    // ...
  ],

  tsdocSidebar: [
    tsdocSidebarItems,
  ],
};
```

## Top Menu

The converter also generates a dropdown menu entry for integration into the top navigation bar.

To incorporate this into Docusaurus, first edit your `docusaurus-config.ts` file and add the following import at the top:

```ts
import tsdocApiMenu from './docusaurus-config-navbar-tsdoc.json'
```

Subsequently, add `tsdocApiMenu` to the `navbar.items` array, for example,
between the **Documentation** and **Blog** drop-downs.

## TSDoc Guide

See the separate [TSDOC-GUIDE](https://github.com/xpack/tsdoc2docusaurus-cli-ts/blob/master/TSDOC-GUIDE.md) file.